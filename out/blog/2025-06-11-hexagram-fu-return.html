<!DOCTYPE html><html lang="en" class="__variable_245d8d __variable_97c177 antialiased"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/27834908180db20f-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/78fec81b34c4a365.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/45441016e214994e.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-19293e76a0797e5c.js"/><script src="/_next/static/chunks/8b8ad143-e83b7b49f5b24ad0.js" async=""></script><script src="/_next/static/chunks/766-52c0c652dbe24189.js" async=""></script><script src="/_next/static/chunks/main-app-e8025b732b0b8d44.js" async=""></script><script src="/_next/static/chunks/cd24890f-00c67ea9d0bbf445.js" async=""></script><script src="/_next/static/chunks/933-166e0fcc9496c98f.js" async=""></script><script src="/_next/static/chunks/app/layout-d687a3a56998d23e.js" async=""></script><script src="/_next/static/chunks/771-2096a43097a1ac56.js" async=""></script><script src="/_next/static/chunks/698-980099c394b58d6f.js" async=""></script><script src="/_next/static/chunks/218-3bb2d990159730f8.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js" async=""></script><meta name="next-size-adjust" content=""/><meta name="theme-color" content="black"/><title>Hexagram 24 — Fù: Idempotency and Recovery Patterns - Hanzo Blog</title><meta name="description" content="Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible."/><link rel="author" href="https://hanzo.blog"/><meta name="author" content="Hanzo AI"/><meta name="keywords" content="Hexagram 24 — Fù: Idempotency and Recovery Patterns,iching,engineering,idempotency,recovery,fault-tolerance,distributed-systems,Hanzo AI,Blog,AI Research,Infrastructure"/><meta name="creator" content="Hanzo AI"/><meta name="publisher" content="Hanzo AI"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://hanzo.blog/blog/2025-06-11-hexagram-fu-return"/><meta property="og:title" content="Hexagram 24 — Fù: Idempotency and Recovery Patterns"/><meta property="og:description" content="Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible."/><meta property="og:url" content="https://hanzo.blog/blog/2025-06-11-hexagram-fu-return"/><meta property="og:site_name" content="Hanzo Blog"/><meta property="og:image" content="https://hanzo.blog/blog/2025-06-11-hexagram-fu-return/opengraph-image"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="Hexagram 24 — Fù: Idempotency and Recovery Patterns"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-06-11"/><meta property="article:author" content="Hanzo AI"/><meta property="article:tag" content="iching"/><meta property="article:tag" content="engineering"/><meta property="article:tag" content="idempotency"/><meta property="article:tag" content="recovery"/><meta property="article:tag" content="fault-tolerance"/><meta property="article:tag" content="distributed-systems"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@hanzoai"/><meta name="twitter:creator" content="@hanzoai"/><meta name="twitter:title" content="Hexagram 24 — Fù: Idempotency and Recovery Patterns"/><meta name="twitter:description" content="Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible."/><meta name="twitter:image" content="https://hanzo.blog/blog/2025-06-11-hexagram-fu-return/opengraph-image"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><script>((e,t,r,n,i,o,a,s)=>{let l=document.documentElement,u=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&o?i.map(e=>o[e]||e):i;r?(l.classList.remove(...n),l.classList.add(o&&o[t]?o[t]:t)):l.setAttribute(e,t)}),r=t,s&&u.includes(r)&&(l.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=a&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><header class="border-b border-border/50 px-6 py-4 sticky top-0 z-20 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="max-w-5xl mx-auto flex items-center justify-between"><a href="https://hanzo.ai" class="flex items-center gap-2 text-foreground hover:opacity-80 transition-opacity"><img alt="Hanzo" loading="lazy" width="20" height="20" decoding="async" data-nimg="1" class="dark:invert-0 invert" style="color:transparent" src="/hanzo-logo.svg"/><span class="font-semibold text-base tracking-tight">hanzo</span><span class="text-muted-foreground text-sm">/ blog</span></a><nav class="flex items-center gap-4 text-sm text-muted-foreground"><a href="https://hanzo.ai" class="hover:text-foreground transition-colors">hanzo.ai</a><a href="https://blog.zoo.ngo" class="hover:text-foreground transition-colors hidden sm:block">zoo</a><a href="https://zenlm.org/blog" class="hover:text-foreground transition-colors hidden sm:block">zen</a><a href="https://zeekay.blog" class="hover:text-foreground transition-colors hidden sm:block">zeekay</a><a href="https://discord.gg/hanzo" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border text-foreground hover:bg-accent transition-all text-sm font-medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle h-3.5 w-3.5" aria-hidden="true"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg>Discord</a></nav></div></header><div class="min-h-screen bg-background relative"><div class="absolute top-0 left-0 z-0 w-full h-[200px] [mask-image:linear-gradient(to_top,transparent_25%,black_95%)]"><div class="absolute top-0 left-0 size-full"><canvas class="pointer-events-none" style="width:0;height:0"></canvas></div></div><div class="space-y-4 border-b border-border relative z-10"><div class="max-w-7xl mx-auto flex flex-col gap-6 p-6"><div class="flex flex-wrap items-center gap-3 gap-y-5 text-sm text-muted-foreground"><a class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[&gt;svg]:px-3 h-6 w-6" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span class="sr-only">Back to all articles</span></a><div class="flex flex-wrap gap-3 text-muted-foreground"><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">iching</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">engineering</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">idempotency</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">recovery</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">fault-tolerance</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">distributed-systems</span></div><time class="font-medium text-muted-foreground">June 10, 2025</time></div><h1 class="text-4xl md:text-5xl lg:text-6xl font-medium tracking-tighter text-balance">Hexagram 24 — Fù: Idempotency and Recovery Patterns</h1><p class="text-muted-foreground max-w-4xl md:text-lg md:text-balance">Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible.</p></div></div><div class="flex divide-x divide-border relative max-w-7xl mx-auto px-4 md:px-0 z-10"><div class="absolute max-w-7xl mx-auto left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] lg:w-full h-full border-x border-border p-0 pointer-events-none"></div><main class="w-full p-0 overflow-hidden"><div class="p-6 lg:p-10"><div class="prose dark:prose-invert max-w-none prose-headings:scroll-mt-8 prose-headings:font-semibold prose-a:no-underline prose-headings:tracking-tight prose-headings:text-balance prose-p:tracking-tight prose-p:text-balance prose-lg"><div class="prose"><h1 id="-fù--return-systems-that-come-back-correctly" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">䷗ Fù — Return: Systems That Come Back Correctly<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h1>
<p>Thunder far below earth. The winter solstice — the darkest moment, when the light begins to return. The twenty-fourth hexagram is about return: not just coming back, but coming back to the same state. The yang energy that left in autumn returns in winter. It is the same energy. The cycle completes.</p>
<p>In distributed systems, &quot;return to known good state&quot; is not automatic — it is an engineered property. Idempotency, recovery patterns, and careful state machine design are what make return reliable.</p>
<h2 id="idempotency-the-foundation-of-safe-retry" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">Idempotency: The Foundation of Safe Retry<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>An operation is idempotent if performing it multiple times has the same effect as performing it once. <code>GET /orders/123</code> is idempotent — calling it ten times returns the same order (or an error if it doesn&#x27;t exist) without side effects. <code>POST /orders</code> is not inherently idempotent — calling it ten times creates ten orders.</p>
<p>The problem idempotency solves: in distributed systems, networks fail. When a network call fails, the caller doesn&#x27;t know whether the server received the request and failed on the response, or never received the request at all. If the operation is not idempotent, retrying is dangerous — it may create duplicate side effects.</p>
<p>The solution: idempotency keys. The caller generates a unique key for each logical operation and includes it with the request. The server records the key when processing the operation. If the same key arrives again, the server returns the recorded result without re-executing the operation.</p>
<p>For the Hanzo payment processing API: every charge request includes an idempotency key generated by the client. If the charge request times out, the client retries with the same key. The payment processor either processes the charge (if it was never processed) or returns the original result (if it was already processed). The user is never double-charged.</p>
<h2 id="the-state-machine-constraint" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">The State Machine Constraint<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Idempotency at the operation level requires clear state transitions at the object level. An order has states: <code>pending</code>, <code>confirmed</code>, <code>processing</code>, <code>fulfilled</code>, <code>cancelled</code>. Transitions between states are defined: an order can move from <code>pending</code> to <code>confirmed</code>, from <code>confirmed</code> to <code>processing</code>, from <code>processing</code> to <code>fulfilled</code>, from any non-<code>cancelled</code> state to <code>cancelled</code> if the right conditions are met.</p>
<p>What cannot happen: a <code>fulfilled</code> order moving back to <code>processing</code>. A <code>cancelled</code> order being <code>fulfilled</code>. These illegal transitions must be enforced at the data layer, not just the application layer. A well-designed state machine is the foundation of recovery: if you know the valid states and valid transitions, you can always determine whether a system is in a consistent state or not.</p>
<p>Recovery after a partial failure is: find the objects in intermediate states (stuck in <code>processing</code> because the fulfillment step failed), determine what the next correct transition is, and apply it. This is safe only if the state machine is well-defined.</p>
<h2 id="fù-in-distributed-consensus" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">Fù in Distributed Consensus<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>The return pattern has a precise analog in distributed consensus: the recovery of a failed node. When a node in the Lux consensus network fails and restarts, it does not attempt to &quot;resume&quot; from where it left off — it rebuilds its state from the canonical chain. It returns to the known good state defined by the consensus.</p>
<p>This is safe because the consensus state is the ground truth. A node that fails does not hold a view of the world that is more current than the consensus. On recovery, it aligns with the consensus and resumes from that alignment.</p>
<p>The same principle applies to any replicated state machine: the recovery procedure is &quot;read the log, replay to current state.&quot; The log is the source of truth. Recovery is return.</p>
<h2 id="saga-pattern-for-distributed-transactions" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">Saga Pattern for Distributed Transactions<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Long-running distributed operations — booking a flight, fulfilling a multi-warehouse order, settling a cross-chain transaction — cannot be covered by a single database transaction. The saga pattern addresses this: a sequence of local transactions, each with a compensating transaction that reverses its effects.</p>
<p>If step 3 of a 5-step saga fails, the recovery procedure is to execute the compensating transactions for steps 1 and 2 (returning the system to the pre-saga state), then report the failure to the caller.</p>
<p>Fù: the return is structured. The compensating transactions are defined up front, before the saga begins. The recovery path is designed, not improvised.</p>
<p>Systems that return correctly do not do so by accident. They do so because return was designed as a first-class requirement.</p></div></div></div><div class="mt-10"><section class="border-t border-border p-0"><div class="p-6 lg:p-10"><h2 class="text-2xl font-medium mb-8">Read more</h2><div class="flex flex-col gap-8"><a class="group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer" href="/blog/2026-02-04-hexagram-xiao-guo-small-exceeding"><div class="space-y-2 flex-1 col-span-1 lg:col-span-8"><h3 class="text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2">Hexagram 62 — Xiǎo Guò: Precision at Scale and the Small Exceeding</h3><p class="text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4">Xiǎo Guò is small exceeding — going slightly beyond the ordinary in small things while staying within bounds in large ones. In distributed systems, this is the attention to numerical precision, timing accuracy, and detail that separates systems that work at scale from ones that only work in demos.</p><time class="block text-xs font-medium text-muted-foreground">February 3, 2026</time></div></a><a class="group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer" href="/blog/2026-01-14-hexagram-huan-dispersion"><div class="space-y-2 flex-1 col-span-1 lg:col-span-8"><h3 class="text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2">Hexagram 59 — Huàn: Breaking Monoliths and the Distributed System</h3><p class="text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4">Huàn is dispersion — the thaw that breaks the ice, allowing water to flow freely again. The monolith that has become a constraint must be dispersed. But dispersion without direction is chaos. The art is in choosing what boundaries to draw.</p><time class="block text-xs font-medium text-muted-foreground">January 13, 2026</time></div></a><a class="group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer" href="/blog/2025-07-30-hexagram-xian-influence"><div class="space-y-2 flex-1 col-span-1 lg:col-span-8"><h3 class="text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2">Hexagram 31 — Xián: Network Effects and Emergent System Behavior</h3><p class="text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4">Lake above mountain — mutual influence between unlike things. Xián is resonance: the influence that systems exert on each other without force. Network effects, emergent behavior, and the compounding value of interconnected protocols.</p><time class="block text-xs font-medium text-muted-foreground">July 29, 2025</time></div></a></div></div></section></div></main><aside class="hidden lg:block w-[350px] flex-shrink-0 p-6 lg:p-10 bg-muted/60 dark:bg-muted/20"><div class="sticky top-20 space-y-8"><div class="flex items-start gap-2"><div class="flex-1"><h3 class="text-sm tracking-tight text-balance font-semibold">Hanzo AI</h3></div></div><div class="border border-border rounded-lg p-6 bg-card"></div></div></aside></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«R2nnelb»" data-state="closed" class="lg:hidden fixed bottom-6 right-6 z-50 bg-primary text-primary-foreground p-3 rounded-full shadow-lg hover:bg-primary/90 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list" aria-hidden="true"><path d="M3 12h.01"></path><path d="M3 18h.01"></path><path d="M3 6h.01"></path><path d="M8 12h13"></path><path d="M8 18h13"></path><path d="M8 6h13"></path></svg></button></div><!--$--><!--/$--><footer class="border-t border-border/50 px-6 py-6 mt-auto"><div class="max-w-5xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground"><div class="flex items-center gap-2"><img alt="Hanzo" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="dark:invert-0 invert opacity-50" style="color:transparent" src="/hanzo-logo.svg"/><span>© 2025 Hanzo AI, Inc. Techstars &#x27;17.</span></div><div class="flex items-center gap-4"><a href="https://hanzo.ai/privacy" class="hover:text-foreground transition-colors">Privacy</a><a href="https://hanzo.ai/terms" class="hover:text-foreground transition-colors">Terms</a><a href="https://blog.zoo.ngo" class="hover:text-foreground transition-colors hidden sm:block">zoo blog</a><a href="https://zenlm.org/blog" class="hover:text-foreground transition-colors hidden sm:block">zen blog</a><a href="https://zeekay.blog" class="hover:text-foreground transition-colors hidden sm:block">zeekay.blog</a><a href="https://github.com/hanzoai" target="_blank" rel="noopener noreferrer" class="hover:text-foreground transition-colors">GitHub</a></div></div></footer><script src="/_next/static/chunks/webpack-19293e76a0797e5c.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[861,[\"803\",\"static/chunks/cd24890f-00c67ea9d0bbf445.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"177\",\"static/chunks/app/layout-d687a3a56998d23e.js\"],\"PostHogProvider\"]\n3:I[2710,[\"803\",\"static/chunks/cd24890f-00c67ea9d0bbf445.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"177\",\"static/chunks/app/layout-d687a3a56998d23e.js\"],\"ThemeProvider\"]\n4:I[9933,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"Image\"]\n5:I[3977,[],\"\"]\n6:I[8765,[],\"\"]\n7:I[4526,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"FlickeringGrid\"]\n8:I[1964,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"\"]\na:I[2463,[],\"OutletBoundary\"]\nd:I[373,[],\"AsyncMetadataOutlet\"]\nf:I[2463,[],\"ViewportBoundary\"]\n11:I[2463,[],\"MetadataBoundary\"]\n13:I[680,[],\"\"]\n:HL[\"/_next/static/media/27834908180db20f-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/78fec81b34c4a365.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/45441016e214994e.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"yeRLKKIdrV-2cpcPU6Jw-\",\"p\":\"\",\"c\":[\"\",\"blog\",\"2025-06-11-hexagram-fu-return\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"2025-06-11-hexagram-fu-return\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/45441016e214994e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__variable_245d8d __variable_97c177 antialiased\",\"suppressHydrationWarning\":true,\"children\":[\"$undefined\",[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[[\"$\",\"header\",null,{\"className\":\"border-b border-border/50 px-6 py-4 sticky top-0 z-20 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-5xl mx-auto flex items-center justify-between\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai\",\"className\":\"flex items-center gap-2 text-foreground hover:opacity-80 transition-opacity\",\"children\":[[\"$\",\"$L4\",null,{\"src\":\"/hanzo-logo.svg\",\"alt\":\"Hanzo\",\"width\":20,\"height\":20,\"className\":\"dark:invert-0 invert\"}],[\"$\",\"span\",null,{\"className\":\"font-semibold text-base tracking-tight\",\"children\":\"hanzo\"}],[\"$\",\"span\",null,{\"className\":\"text-muted-foreground text-sm\",\"children\":\"/ blog\"}]]}],[\"$\",\"nav\",null,{\"className\":\"flex items-center gap-4 text-sm text-muted-foreground\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"hanzo.ai\"}],[\"$\",\"a\",null,{\"href\":\"https://blog.zoo.ngo\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"zoo\"}],[\"$\",\"a\",null,{\"href\":\"https://zenlm.org/blog\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"zen\"}],[\"$\",\"a\",null,{\"href\":\"https://zeekay.blog\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"zeekay\"}],[\"$\",\"a\",null,{\"href\":\"https://discord.gg/hanzo\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border text-foreground hover:bg-accent transition-all text-sm font-medium\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-message-circle h-3.5 w-3.5\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"vv11sd\",{\"d\":\"M7.9 20A9 9 0 1 0 4 16.1L2 22Z\"}],\"$undefined\"]}],\"Discord\"]}]]}]]}]}],[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-background flex items-center justify-center w-full z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-0 left-0 z-0 w-full h-[500px] [mask-image:linear-gradient(to_top,transparent_25%,black_95%)]\",\"children\":[\"$\",\"$L7\",null,{\"className\":\"absolute top-0 left-0 size-full\",\"squareSize\":4,\"gridGap\":6,\"color\":\"#6B7280\",\"maxOpacity\":0.5,\"flickerChance\":0.1}]}],[\"$\",\"div\",null,{\"className\":\"text-center flex flex-col gap-4 max-w-xs mx-auto relative\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-8xl font-mono font-bold drop-shadow-lg text-primary\",\"children\":\"404\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-base leading-relaxed text-center tracking-tight text-balance\",\"children\":\"Sorry, we couldn't find the page you're looking for. The page might have been moved, deleted, or you entered the wrong URL.\"}],[\"$\",\"$L8\",null,{\"href\":\"/\",\"children\":\"Back to Home\",\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive bg-primary text-primary-foreground shadow-xs hover:bg-primary/90 px-4 py-2 has-[\u003esvg]:px-3 w-full rounded-lg h-9 drop-shadow-lg\",\"ref\":null}]]}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"border-t border-border/50 px-6 py-6 mt-auto\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-5xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2\",\"children\":[[\"$\",\"$L4\",null,{\"src\":\"/hanzo-logo.svg\",\"alt\":\"Hanzo\",\"width\":16,\"height\":16,\"className\":\"dark:invert-0 invert opacity-50\"}],[\"$\",\"span\",null,{\"children\":\"© 2025 Hanzo AI, Inc. Techstars '17.\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-4\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai/privacy\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Privacy\"}],[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai/terms\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Terms\"}],[\"$\",\"a\",null,{\"href\":\"https://blog.zoo.ngo\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"zoo blog\"}],[\"$\",\"a\",null,{\"href\":\"https://zenlm.org/blog\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"zen blog\"}],[\"$\",\"a\",null,{\"href\":\"https://zeekay.blog\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"zeekay.blog\"}],[\"$\",\"a\",null,{\"href\":\"https://github.com/hanzoai\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"GitHub\"}]]}]]}]}]]}]}]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"2025-06-11-hexagram-fu-return\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L5\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L6\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L9\",null,[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"M13ZO6QemNoakS4pKFXylv\",{\"children\":[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$L11\",null,{\"children\":\"$L12\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$13\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"14:\"$Sreact.suspense\"\n15:I[373,[],\"AsyncMetadata\"]\n17:I[9048,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"HashScrollHandler\"]\n18:I[4170,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"CopyHeader\"]\n19:I[9372,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"TableOfContents\"]\n1a:I[1413,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"MobileTableOfContents\"]\n12:[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$14\",null,{\"fallback\":null,\"children\":[\"$\",\"$L15\",null,{\"promise\":\"$@16\"}]}]}]\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-background relative\",\"children\":[[\"$\",\"$L17\",null,{}],[\"$\",\"div\",null,{\"className\":\"absolute top-0 left-0 z-0 w-full h-[200px] [mask-image:linear-gradient(to_top,transparent_25%,black_95%)]\",\"children\":[\"$\",\"$L7\",null,{\"className\":\"absolute top-0 left-0 size-full\",\"squareSize\":4,\"gridGap\":6,\"color\":\"#6B7280\",\"maxOpacity\":0.2,\"flickerChance\":0.05}]}],[\"$\",\"div\",null,{\"className\":\"space-y-4 border-b border-border relative z-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto flex flex-col gap-6 p-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-3 gap-y-5 text-sm text-muted-foreground\",\"children\":[[\"$\",\"$L8\",null,{\"href\":\"/\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"Back to all articles\"}]],\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[\u003esvg]:px-3 h-6 w-6\",\"ref\":null}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-3 text-muted-foreground\",\"children\":[[\"$\",\"span\",\"iching\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"iching\"}],[\"$\",\"span\",\"engineering\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"engineering\"}],[\"$\",\"span\",\"idempotency\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"idempotency\"}],[\"$\",\"span\",\"recovery\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"recovery\"}],[\"$\",\"span\",\"fault-tolerance\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"fault-tolerance\"}],[\"$\",\"span\",\"distributed-systems\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"distributed-systems\"}]]}],[\"$\",\"time\",null,{\"className\":\"font-medium text-muted-foreground\",\"children\":\"June 10, 2025\"}]]}],[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-5xl lg:text-6xl font-medium tracking-tighter text-balance\",\"children\":\"Hexagram 24 — Fù: Idempotency and Recovery Patterns\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground max-w-4xl md:text-lg md:text-balance\",\"children\":\"Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible.\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex divide-x divide-border relative max-w-7xl mx-auto px-4 md:px-0 z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute max-w-7xl mx-auto left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] lg:w-full h-full border-x border-border p-0 pointer-events-none\"}],[\"$\",\"main\",null,{\"className\":\"w-full p-0 overflow-hidden\",\"children\":[null,[\"$\",\"div\",null,{\"className\":\"p-6 lg:p-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose dark:prose-invert max-w-none prose-headings:scroll-mt-8 prose-headings:font-semibold prose-a:no-underline prose-headings:tracking-tight prose-headings:text-balance prose-p:tracking-tight prose-p:text-balance prose-lg\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"children\":[[\"$\",\"$L18\",null,{\"level\":1,\"id\":\"-fù--return-systems-that-come-back-correctly\",\"children\":\"䷗ Fù — Return: Systems That Come Back Correctly\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Thunder far below earth. The winter solstice — the darkest moment, when the light begins to return. The twenty-fourth hexagram is about return: not just coming back, but coming back to the same state. The yang energy that left in autumn returns in winter. It is the same energy. The cycle completes.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In distributed systems, \\\"return to known good state\\\" is not automatic — it is an engineered property. Idempotency, recovery patterns, and careful state machine design are what make return reliable.\"}],\"\\n\",[\"$\",\"$L18\",null,{\"level\":2,\"id\":\"idempotency-the-foundation-of-safe-retry\",\"children\":\"Idempotency: The Foundation of Safe Retry\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"An operation is idempotent if performing it multiple times has the same effect as performing it once. \",[\"$\",\"code\",null,{\"children\":\"GET /orders/123\"}],\" is idempotent — calling it ten times returns the same order (or an error if it doesn't exist) without side effects. \",[\"$\",\"code\",null,{\"children\":\"POST /orders\"}],\" is not inherently idempotent — calling it ten times creates ten orders.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The problem idempotency solves: in distributed systems, networks fail. When a network call fails, the caller doesn't know whether the server received the request and failed on the response, or never received the request at all. If the operation is not idempotent, retrying is dangerous — it may create duplicate side effects.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The solution: idempotency keys. The caller generates a unique key for each logical operation and includes it with the request. The server records the key when processing the operation. If the same key arrives again, the server returns the recorded result without re-executing the operation.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"For the Hanzo payment processing API: every charge request includes an idempotency key generated by the client. If the charge request times out, the client retries with the same key. The payment processor either processes the charge (if it was never processed) or returns the original result (if it was already processed). The user is never double-charged.\"}],\"\\n\",[\"$\",\"$L18\",null,{\"level\":2,\"id\":\"the-state-machine-constraint\",\"children\":\"The State Machine Constraint\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Idempotency at the operation level requires clear state transitions at the object level. An order has states: \",[\"$\",\"code\",null,{\"children\":\"pending\"}],\", \",[\"$\",\"code\",null,{\"children\":\"confirmed\"}],\", \",[\"$\",\"code\",null,{\"children\":\"processing\"}],\", \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\", \",[\"$\",\"code\",null,{\"children\":\"cancelled\"}],\". Transitions between states are defined: an order can move from \",[\"$\",\"code\",null,{\"children\":\"pending\"}],\" to \",[\"$\",\"code\",null,{\"children\":\"confirmed\"}],\", from \",[\"$\",\"code\",null,{\"children\":\"confirmed\"}],\" to \",[\"$\",\"code\",null,{\"children\":\"processing\"}],\", from \",[\"$\",\"code\",null,{\"children\":\"processing\"}],\" to \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\", from any non-\",[\"$\",\"code\",null,{\"children\":\"cancelled\"}],\" state to \",[\"$\",\"code\",null,{\"children\":\"cancelled\"}],\" if the right conditions are met.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"What cannot happen: a \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\" order moving back to \",[\"$\",\"code\",null,{\"children\":\"processing\"}],\". A \",[\"$\",\"code\",null,{\"children\":\"cancelled\"}],\" order being \",[\"$\",\"code\",null,{\"children\":\"fulfilled\"}],\". These illegal transitions must be enforced at the data layer, not just the application layer. A well-designed state machine is the foundation of recovery: if you know the valid states and valid transitions, you can always determine whether a system is in a consistent state or not.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Recovery after a partial failure is: find the objects in intermediate states (stuck in \",[\"$\",\"code\",null,{\"children\":\"processing\"}],\" because the fulfillment step failed), determine what the next correct transition is, and apply it. This is safe only if the state machine is well-defined.\"]}],\"\\n\",[\"$\",\"$L18\",null,{\"level\":2,\"id\":\"fù-in-distributed-consensus\",\"children\":\"Fù in Distributed Consensus\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The return pattern has a precise analog in distributed consensus: the recovery of a failed node. When a node in the Lux consensus network fails and restarts, it does not attempt to \\\"resume\\\" from where it left off — it rebuilds its state from the canonical chain. It returns to the known good state defined by the consensus.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is safe because the consensus state is the ground truth. A node that fails does not hold a view of the world that is more current than the consensus. On recovery, it aligns with the consensus and resumes from that alignment.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The same principle applies to any replicated state machine: the recovery procedure is \\\"read the log, replay to current state.\\\" The log is the source of truth. Recovery is return.\"}],\"\\n\",[\"$\",\"$L18\",null,{\"level\":2,\"id\":\"saga-pattern-for-distributed-transactions\",\"children\":\"Saga Pattern for Distributed Transactions\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Long-running distributed operations — booking a flight, fulfilling a multi-warehouse order, settling a cross-chain transaction — cannot be covered by a single database transaction. The saga pattern addresses this: a sequence of local transactions, each with a compensating transaction that reverses its effects.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If step 3 of a 5-step saga fails, the recovery procedure is to execute the compensating transactions for steps 1 and 2 (returning the system to the pre-saga state), then report the failure to the caller.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Fù: the return is structured. The compensating transactions are defined up front, before the saga begins. The recovery path is designed, not improvised.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Systems that return correctly do not do so by accident. They do so because return was designed as a first-class requirement.\"}]],\"className\":\"prose\"}]}]}],[\"$\",\"div\",null,{\"className\":\"mt-10\",\"children\":[\"$\",\"section\",null,{\"className\":\"border-t border-border p-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"p-6 lg:p-10\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl font-medium mb-8\",\"children\":\"Read more\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col gap-8\",\"children\":[[\"$\",\"$L8\",\"/blog/2026-02-04-hexagram-xiao-guo-small-exceeding\",{\"href\":\"/blog/2026-02-04-hexagram-xiao-guo-small-exceeding\",\"className\":\"group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-2 flex-1 col-span-1 lg:col-span-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2\",\"children\":\"Hexagram 62 — Xiǎo Guò: Precision at Scale and the Small Exceeding\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4\",\"children\":\"Xiǎo Guò is small exceeding — going slightly beyond the ordinary in small things while staying within bounds in large ones. In distributed systems, this is the attention to numerical precision, timing accuracy, and detail that separates systems that work at scale from ones that only work in demos.\"}],[\"$\",\"time\",null,{\"className\":\"block text-xs font-medium text-muted-foreground\",\"children\":\"February 3, 2026\"}]]}]]}],[\"$\",\"$L8\",\"/blog/2026-01-14-hexagram-huan-dispersion\",{\"href\":\"/blog/2026-01-14-hexagram-huan-dispersion\",\"className\":\"group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-2 flex-1 col-span-1 lg:col-span-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2\",\"children\":\"Hexagram 59 — Huàn: Breaking Monoliths and the Distributed System\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4\",\"children\":\"Huàn is dispersion — the thaw that breaks the ice, allowing water to flow freely again. The monolith that has become a constraint must be dispersed. But dispersion without direction is chaos. The art is in choosing what boundaries to draw.\"}],[\"$\",\"time\",null,{\"className\":\"block text-xs font-medium text-muted-foreground\",\"children\":\"January 13, 2026\"}]]}]]}],[\"$\",\"$L8\",\"/blog/2025-07-30-hexagram-xian-influence\",{\"href\":\"/blog/2025-07-30-hexagram-xian-influence\",\"className\":\"group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-2 flex-1 col-span-1 lg:col-span-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2\",\"children\":\"Hexagram 31 — Xián: Network Effects and Emergent System Behavior\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4\",\"children\":\"Lake above mountain — mutual influence between unlike things. Xián is resonance: the influence that systems exert on each other without force. Network effects, emergent behavior, and the compounding value of interconnected protocols.\"}],[\"$\",\"time\",null,{\"className\":\"block text-xs font-medium text-muted-foreground\",\"children\":\"July 29, 2025\"}]]}]]}]]}]]}]}]}]]}],[\"$\",\"aside\",null,{\"className\":\"hidden lg:block w-[350px] flex-shrink-0 p-6 lg:p-10 bg-muted/60 dark:bg-muted/20\",\"children\":[\"$\",\"div\",null,{\"className\":\"sticky top-20 space-y-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-start gap-2\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"h3\",null,{\"className\":\"text-sm tracking-tight text-balance font-semibold\",\"children\":\"Hanzo AI\"}]}]}],[\"$\",\"div\",null,{\"className\":\"border border-border rounded-lg p-6 bg-card\",\"children\":[\"$\",\"$L19\",null,{}]}]]}]}]]}],[\"$\",\"$L1a\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"c:null\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"2\",{\"name\":\"theme-color\",\"content\":\"black\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"e:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Hexagram 24 — Fù: Idempotency and Recovery Patterns - Hanzo Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"author\",\"href\":\"https://hanzo.blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"author\",\"content\":\"Hanzo AI\"}],[\"$\",\"meta\",\"4\",{\"name\":\"keywords\",\"content\":\"Hexagram 24 — Fù: Idempotency and Recovery Patterns,iching,engineering,idempotency,recovery,fault-tolerance,distributed-systems,Hanzo AI,Blog,AI Research,Infrastructure\"}],[\"$\",\"meta\",\"5\",{\"name\":\"creator\",\"content\":\"Hanzo AI\"}],[\"$\",\"meta\",\"6\",{\"name\":\"publisher\",\"content\":\"Hanzo AI\"}],[\"$\",\"meta\",\"7\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"8\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"9\",{\"rel\":\"canonical\",\"href\":\"https://hanzo.blog/blog/2025-06-11-hexagram-fu-return\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:title\",\"content\":\"Hexagram 24 — Fù: Idempotency and Recovery Patterns\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:description\",\"content\":\"Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible.\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:url\",\"content\":\"https://hanzo.blog/blog/2025-06-11-hexagram-fu-return\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:site_name\",\"content\":\"Hanzo Blog\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image\",\"content\":\"https://hanzo.blog/blog/2025-06-11-hexagram-fu-return/opengraph-image\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:image:alt\",\"content\":\"Hexagram 24 — Fù: Idempotency and Recovery Patterns\"}],[\"$\",\"meta\",\"18\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"19\",{\"property\":\"article:published_time\",\"content\":\"2025-06-11\"}],[\"$\",\"meta\",\"20\",{\"property\":\"article:author\",\"content\":\"Hanzo AI\"}],[\"$\",\"meta\",\"21\",{\"property\":\"article:tag\",\"content\":\"iching\"}],[\"$\",\"meta\",\"22\",{\"property\":\"article:tag\",\"content\":\"engineering\"}],[\"$\",\"meta\",\"23\",{\"property\":\"article:tag\",\"content\":\"idempotency\"}],[\"$\",\"meta\",\"24\",{\"property\":\"article:tag\",\"content\":\"recovery\"}],[\"$\",\"meta\",\"25\",{\"property\":\"article:tag\",\"content\":\"fault-tolerance\"}],[\"$\",\"meta\",\"26\",{\"property\":\"article:tag\",\"content\":\"distributed-systems\"}],[\"$\",\"meta\",\"27\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"28\",{\"name\":\"twitter:site\",\"content\":\"@hanzoai\"}],[\"$\",\"meta\",\"29\",{\"name\":\"twitter:creator\",\"content\":\"@hanzoai\"}],[\"$\",\"meta\",\"30\",{\"name\":\"twitter:title\",\"content\":\"Hexagram 24 — Fù: Idempotency and Recovery Patterns\"}],[\"$\",\"meta\",\"31\",{\"name\":\"twitter:description\",\"content\":\"Thunder deep in the earth — the return of vitality after winter. Fù is the return to a known good state. Idempotency ensures that returning is safe. Recovery patterns ensure that returning is possible.\"}],[\"$\",\"meta\",\"32\",{\"name\":\"twitter:image\",\"content\":\"https://hanzo.blog/blog/2025-06-11-hexagram-fu-return/opengraph-image\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"16:{\"metadata\":\"$e:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>