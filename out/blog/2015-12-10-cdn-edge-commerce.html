<!DOCTYPE html><html lang="en" class="__variable_245d8d __variable_97c177 antialiased"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/27834908180db20f-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/78fec81b34c4a365.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/5ecf9fcd3bbfeb13.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-19293e76a0797e5c.js"/><script src="/_next/static/chunks/8b8ad143-e83b7b49f5b24ad0.js" async=""></script><script src="/_next/static/chunks/766-52c0c652dbe24189.js" async=""></script><script src="/_next/static/chunks/main-app-e8025b732b0b8d44.js" async=""></script><script src="/_next/static/chunks/933-166e0fcc9496c98f.js" async=""></script><script src="/_next/static/chunks/app/layout-47e4a7ab857a36d7.js" async=""></script><script src="/_next/static/chunks/771-2096a43097a1ac56.js" async=""></script><script src="/_next/static/chunks/698-980099c394b58d6f.js" async=""></script><script src="/_next/static/chunks/218-3bb2d990159730f8.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js" async=""></script><meta name="next-size-adjust" content=""/><meta name="theme-color" content="black"/><title>CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t - Hanzo Blog</title><meta name="description" content="Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize."/><link rel="author" href="https://blog.hanzo.ai"/><meta name="author" content="Zach Kelling"/><meta name="keywords" content="CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t,cdn,cloudflare,performance,commerce,caching,Hanzo AI,Blog,AI Research,Infrastructure"/><meta name="creator" content="Zach Kelling"/><meta name="publisher" content="Hanzo AI"/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce"/><meta property="og:title" content="CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t"/><meta property="og:description" content="Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize."/><meta property="og:url" content="https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce"/><meta property="og:site_name" content="Hanzo Blog"/><meta property="og:image" content="https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce/opengraph-image"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:image:alt" content="CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2015-12-10"/><meta property="article:author" content="Zach Kelling"/><meta property="article:tag" content="cdn"/><meta property="article:tag" content="cloudflare"/><meta property="article:tag" content="performance"/><meta property="article:tag" content="commerce"/><meta property="article:tag" content="caching"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@hanzoai"/><meta name="twitter:creator" content="@hanzoai"/><meta name="twitter:title" content="CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t"/><meta name="twitter:description" content="Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize."/><meta name="twitter:image" content="https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce/opengraph-image"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><div hidden=""><!--$--><!--/$--></div><script>((e,t,r,n,o,a,i,l)=>{let s=document.documentElement,u=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&a?o.map(e=>a[e]||e):o;r?(s.classList.remove(...n),s.classList.add(a&&a[t]?a[t]:t)):s.setAttribute(e,t)}),r=t,l&&u.includes(r)&&(s.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=i&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","dark",null,["light","dark"],null,true,true)</script><header class="border-b border-border/50 px-6 py-4 sticky top-0 z-20 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60"><div class="max-w-5xl mx-auto flex items-center justify-between"><a href="https://hanzo.ai" class="flex items-center gap-2 text-foreground hover:opacity-80 transition-opacity"><img alt="Hanzo" loading="lazy" width="20" height="20" decoding="async" data-nimg="1" class="dark:invert-0 invert" style="color:transparent" src="/hanzo-logo.svg"/><span class="font-semibold text-base tracking-tight">hanzo</span><span class="text-muted-foreground text-sm">/ blog</span></a><nav class="flex items-center gap-4 text-sm text-muted-foreground"><a href="https://hanzo.ai" class="hover:text-foreground transition-colors">hanzo.ai</a><a href="https://hanzo.help" class="hover:text-foreground transition-colors hidden sm:block">Help</a><a href="https://discord.gg/hanzo" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border text-foreground hover:bg-accent transition-all text-sm font-medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle h-3.5 w-3.5" aria-hidden="true"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg>Discord</a></nav></div></header><div class="min-h-screen bg-background relative"><div class="absolute top-0 left-0 z-0 w-full h-[200px] [mask-image:linear-gradient(to_top,transparent_25%,black_95%)]"><div class="absolute top-0 left-0 size-full"><canvas class="pointer-events-none" style="width:0;height:0"></canvas></div></div><div class="space-y-4 border-b border-border relative z-10"><div class="max-w-7xl mx-auto flex flex-col gap-6 p-6"><div class="flex flex-wrap items-center gap-3 gap-y-5 text-sm text-muted-foreground"><a class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:pointer-events-none [&amp;_svg:not([class*=&#x27;size-&#x27;])]:size-4 shrink-0 [&amp;_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[&gt;svg]:px-3 h-6 w-6" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span class="sr-only">Back to all articles</span></a><div class="flex flex-wrap gap-3 text-muted-foreground"><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">cdn</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">cloudflare</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">performance</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">commerce</span><span class="h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center">caching</span></div><time class="font-medium text-muted-foreground">December 9, 2015</time></div><h1 class="text-4xl md:text-5xl lg:text-6xl font-medium tracking-tighter text-balance">CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t</h1><p class="text-muted-foreground max-w-4xl md:text-lg md:text-balance">Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize.</p></div></div><div class="flex divide-x divide-border relative max-w-7xl mx-auto px-4 md:px-0 z-10"><div class="absolute max-w-7xl mx-auto left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] lg:w-full h-full border-x border-border p-0 pointer-events-none"></div><main class="w-full p-0 overflow-hidden"><div class="p-6 lg:p-10"><div class="prose dark:prose-invert max-w-none prose-headings:scroll-mt-8 prose-headings:font-semibold prose-a:no-underline prose-headings:tracking-tight prose-headings:text-balance prose-p:tracking-tight prose-p:text-balance prose-lg"><div class="prose"><h1 id="cdn-and-edge-delivery-for-commerce-what-you-can-cache-and-what-you-cant" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">CDN and Edge Delivery for Commerce: What You Can Cache and What You Can&#x27;t<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h1>
<p>In late 2015 we had moved most of our static assets to Cloudflare. This is the story of what that decision involved, what worked, and the near-disaster of nearly putting checkout behind a CDN cache.</p>
<h2 id="cloudflare-in-2015" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">Cloudflare in 2015<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Cloudflare&#x27;s free tier had launched in 2010 and their pro/business tiers were well-established by 2015. Their CDN was legitimately good — 30+ PoPs globally, anycast routing, and a reverse proxy model that required no changes to your origin server setup beyond a DNS change.</p>
<p>The features we used in 2015: CDN for static assets, DDoS protection (which mattered during peak commerce events — flash sales attracted scraper traffic), and their early Workers product was just becoming available in private beta.</p>
<p>What Cloudflare could not do in 2015: per-request logic at the edge. Their Workers product changed this eventually, but in 2015 the CDN was a pure caching and routing layer. The sophistication was in what you chose to cache and how.</p>
<h2 id="the-three-categories-of-commerce-assets" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">The Three Categories of Commerce Assets<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p><strong>Static assets: always cache, long TTL.</strong> JavaScript bundles, CSS files, fonts, and the Hanzo SDK — these were versioned by content hash in the filename (<code>hanzo-sdk.a3f8c2.min.js</code>). Infinite TTL. The hash changes on every deploy, so cache busting is automatic. A CDN hit serving these from an edge node 20ms from the user is strictly better than a cache miss hitting our origin in a US datacenter.</p>
<p>Image processing was the bigger win. Product images — multiple sizes, WebP and JPEG variants — were stored in S3, served via a CloudFront distribution (later migrated to Cloudflare), and cached at the edge with a 30-day TTL. The origin was never hit for a repeat visitor viewing a product image they had seen before. At scale, product images account for 60-80% of page weight and a significant fraction of origin requests. Eliminating those was meaningful.</p>
<p><strong>Cacheable HTML pages: cache with short TTL and cache-busting strategy.</strong> Category pages, product listing pages, even product detail pages for items with no personalized content — these could be cached at the edge for 5-60 minutes with Stale-While-Revalidate semantics. Not appropriate for personalized pages (cart contents, recommendations based on account history) but fine for the top of funnel.</p>
<p>The Stale-While-Revalidate approach was important: serve the cached version immediately and refresh the cache in the background. This meant edge cache misses did not translate to user-visible latency spikes.</p>
<p><strong>Checkout: never cache, at the edge or anywhere else.</strong> This is where the near-disaster occurred.</p>
<h2 id="the-checkout-caching-mistake-we-almost-made" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">The Checkout Caching Mistake We Almost Made<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>A client asked why their checkout page load was slow. It was — about 900ms TTFB from the US West Coast to their origin in US East. The obvious answer, based on the success we had caching everything else, was &quot;put it behind the CDN.&quot;</p>
<p>We almost did it. The request was to add Cloudflare in front of the checkout domain.</p>
<p>The problem: checkout pages are not idempotent. The checkout flow involves:</p>
<ul>
<li>Session-bound cart state (specific to this user, this device, this session)</li>
<li>CSRF tokens (must be fresh per form load, cannot be reused)</li>
<li>Price calculations that may change between the time a user adds to cart and the time they hit the pay button (inventory, promotions, tax calculation based on shipping address)</li>
<li>Payment tokenization requests that create server-side intent objects tied to specific amounts</li>
</ul>
<p>If you cache a checkout page, you might serve a user someone else&#x27;s CSRF token, someone else&#x27;s cart state, or a stale price for an item that changed. In the worst case, you could serve payment intent data from a previous user&#x27;s session.</p>
<p>We did not implement the CDN for checkout. Instead we:</p>
<ol>
<li>Moved the checkout origin to a US West Coast datacenter (reducing TTFB by ~300ms for that client&#x27;s user base)</li>
<li>Improved server-side rendering time (the 900ms was partly origin latency and partly a slow rendering path)</li>
<li>Prefetched the checkout page in the background when the user added their first item to cart, so by the time they clicked checkout, the page was already warm</li>
</ol>
<p>The prefetch approach gave the user-perceived performance improvement without the safety risks of caching.</p>
<h2 id="cache-control-headers" class="group relative scroll-mt-20 cursor-pointer hover:text-muted-foreground transition-colors duration-200 flex items-center gap-2" title="Click to copy link to this section">Cache-Control Headers<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0" aria-hidden="true"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></h2>
<p>Getting Cache-Control headers right is an operational discipline. The common mistakes:</p>
<ul>
<li>Setting <code>Cache-Control: public, max-age=86400</code> on dynamically generated pages (caches a specific user&#x27;s page for 24 hours, serves it to every subsequent visitor)</li>
<li>Not setting <code>Vary: Accept-Encoding</code> on compressed assets (causing uncompressed responses to be served from cache to clients that accept gzip)</li>
<li>Setting <code>Cache-Control: no-cache</code> when you mean <code>no-store</code> (no-cache means &quot;check with origin before serving&quot;; no-store means &quot;don&#x27;t store this at all&quot;)</li>
</ul>
<p>We standardized on:</p>
<ul>
<li>Static assets with content-hash in filename: <code>Cache-Control: public, max-age=31536000, immutable</code></li>
<li>Product images: <code>Cache-Control: public, max-age=2592000</code> (30 days)</li>
<li>API responses with JSON data: <code>Cache-Control: private, max-age=0, no-store</code></li>
<li>HTML pages: case-by-case, but defaulting to <code>Cache-Control: no-store</code> unless explicitly reviewed</li>
</ul>
<p>The <code>immutable</code> directive (telling the browser not to revalidate even on hard refresh) was new in 2015 and not yet widely supported, but Firefox had it and Chrome was adding it. We used it on the content-hash-named assets.</p>
<hr/>
<p><em>Hanzo completed the Cloudflare CDN migration for static assets in Q4 2015. Checkout pages remained on direct origin delivery. The prefetch pattern for checkout warm-up was implemented for high-traffic clients in the same period.</em></p></div></div></div><div class="mt-10"><section class="border-t border-border p-0"><div class="p-6 lg:p-10"><h2 class="text-2xl font-medium mb-8">Read more</h2><div class="flex flex-col gap-8"><a class="group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer" href="/blog/2024-08-07-candle-ml"><div class="space-y-2 flex-1 col-span-1 lg:col-span-8"><h3 class="text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2">Candle: Rust-Native Machine Learning</h3><p class="text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4">Introducing our investment in Candle, the Rust ML framework powering Hanzo&#x27;s next-generation inference.</p><time class="block text-xs font-medium text-muted-foreground">August 6, 2024</time></div></a><a class="group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer" href="/blog/2022-11-16-identity-nfts"><div class="space-y-2 flex-1 col-span-1 lg:col-span-8"><h3 class="text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2">Identity NFTs: Portable Commerce Identity</h3><p class="text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4">Introducing Identity NFTs: blockchain-based portable identity for commerce.</p><time class="block text-xs font-medium text-muted-foreground">November 15, 2022</time></div></a><a class="group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer" href="/blog/2021-10-27-multi-modal-ai"><div class="space-y-2 flex-1 col-span-1 lg:col-span-8"><h3 class="text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2">Multi-Modal AI for Commerce</h3><p class="text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4">How we are combining vision, language, and structured data for next-generation commerce AI.</p><time class="block text-xs font-medium text-muted-foreground">October 26, 2021</time></div></a></div></div></section></div></main><aside class="hidden lg:block w-[350px] flex-shrink-0 p-6 lg:p-10 bg-muted/60 dark:bg-muted/20"><div class="sticky top-20 space-y-8"><div class="flex items-start gap-2"><div class="flex-1"><h3 class="text-sm tracking-tight text-balance font-semibold">Zach Kelling</h3></div></div><div class="border border-border rounded-lg p-6 bg-card"></div></div></aside></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«Rltrlb»" data-state="closed" class="lg:hidden fixed bottom-6 right-6 z-50 bg-primary text-primary-foreground p-3 rounded-full shadow-lg hover:bg-primary/90 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-list" aria-hidden="true"><path d="M3 12h.01"></path><path d="M3 18h.01"></path><path d="M3 6h.01"></path><path d="M8 12h13"></path><path d="M8 18h13"></path><path d="M8 6h13"></path></svg></button></div><!--$--><!--/$--><footer class="border-t border-border/50 px-6 py-6 mt-auto"><div class="max-w-5xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground"><div class="flex items-center gap-2"><img alt="Hanzo" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="dark:invert-0 invert opacity-50" style="color:transparent" src="/hanzo-logo.svg"/><span>© 2025 Hanzo AI, Inc. Techstars &#x27;17.</span></div><div class="flex items-center gap-4"><a href="https://hanzo.ai/privacy" class="hover:text-foreground transition-colors">Privacy</a><a href="https://hanzo.ai/terms" class="hover:text-foreground transition-colors">Terms</a><a href="https://hanzo.ai/contact" class="hover:text-foreground transition-colors">Contact</a><a href="https://github.com/hanzoai" target="_blank" rel="noopener noreferrer" class="hover:text-foreground transition-colors">GitHub</a></div></div></footer><script src="/_next/static/chunks/webpack-19293e76a0797e5c.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[2710,[\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"177\",\"static/chunks/app/layout-47e4a7ab857a36d7.js\"],\"ThemeProvider\"]\n3:I[9933,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"Image\"]\n4:I[3977,[],\"\"]\n5:I[8765,[],\"\"]\n6:I[4526,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"FlickeringGrid\"]\n7:I[1964,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"\"]\n9:I[2463,[],\"OutletBoundary\"]\nc:I[373,[],\"AsyncMetadataOutlet\"]\ne:I[2463,[],\"ViewportBoundary\"]\n10:I[2463,[],\"MetadataBoundary\"]\n12:I[680,[],\"\"]\n:HL[\"/_next/static/media/27834908180db20f-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/78fec81b34c4a365.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/5ecf9fcd3bbfeb13.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"Szp5DJTNL0ohTsfq4PNfU\",\"p\":\"\",\"c\":[\"\",\"blog\",\"2015-12-10-cdn-edge-commerce\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"2015-12-10-cdn-edge-commerce\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5ecf9fcd3bbfeb13.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"__variable_245d8d __variable_97c177 antialiased\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"dark\",\"enableSystem\":true,\"disableTransitionOnChange\":true,\"children\":[[\"$\",\"header\",null,{\"className\":\"border-b border-border/50 px-6 py-4 sticky top-0 z-20 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-5xl mx-auto flex items-center justify-between\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai\",\"className\":\"flex items-center gap-2 text-foreground hover:opacity-80 transition-opacity\",\"children\":[[\"$\",\"$L3\",null,{\"src\":\"/hanzo-logo.svg\",\"alt\":\"Hanzo\",\"width\":20,\"height\":20,\"className\":\"dark:invert-0 invert\"}],[\"$\",\"span\",null,{\"className\":\"font-semibold text-base tracking-tight\",\"children\":\"hanzo\"}],[\"$\",\"span\",null,{\"className\":\"text-muted-foreground text-sm\",\"children\":\"/ blog\"}]]}],[\"$\",\"nav\",null,{\"className\":\"flex items-center gap-4 text-sm text-muted-foreground\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"hanzo.ai\"}],[\"$\",\"a\",null,{\"href\":\"https://hanzo.help\",\"className\":\"hover:text-foreground transition-colors hidden sm:block\",\"children\":\"Help\"}],[\"$\",\"a\",null,{\"href\":\"https://discord.gg/hanzo\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full border border-border text-foreground hover:bg-accent transition-all text-sm font-medium\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-message-circle h-3.5 w-3.5\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"vv11sd\",{\"d\":\"M7.9 20A9 9 0 1 0 4 16.1L2 22Z\"}],\"$undefined\"]}],\"Discord\"]}]]}]]}]}],[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-background flex items-center justify-center w-full z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute top-0 left-0 z-0 w-full h-[500px] [mask-image:linear-gradient(to_top,transparent_25%,black_95%)]\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"absolute top-0 left-0 size-full\",\"squareSize\":4,\"gridGap\":6,\"color\":\"#6B7280\",\"maxOpacity\":0.5,\"flickerChance\":0.1}]}],[\"$\",\"div\",null,{\"className\":\"text-center flex flex-col gap-4 max-w-xs mx-auto relative\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-8xl font-mono font-bold drop-shadow-lg text-primary\",\"children\":\"404\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-base leading-relaxed text-center tracking-tight text-balance\",\"children\":\"Sorry, we couldn't find the page you're looking for. The page might have been moved, deleted, or you entered the wrong URL.\"}],[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":\"Back to Home\",\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive bg-primary text-primary-foreground shadow-xs hover:bg-primary/90 px-4 py-2 has-[\u003esvg]:px-3 w-full rounded-lg h-9 drop-shadow-lg\",\"ref\":null}]]}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"border-t border-border/50 px-6 py-6 mt-auto\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-5xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2\",\"children\":[[\"$\",\"$L3\",null,{\"src\":\"/hanzo-logo.svg\",\"alt\":\"Hanzo\",\"width\":16,\"height\":16,\"className\":\"dark:invert-0 invert opacity-50\"}],[\"$\",\"span\",null,{\"children\":\"© 2025 Hanzo AI, Inc. Techstars '17.\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex items-center gap-4\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai/privacy\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Privacy\"}],[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai/terms\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Terms\"}],[\"$\",\"a\",null,{\"href\":\"https://hanzo.ai/contact\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Contact\"}],[\"$\",\"a\",null,{\"href\":\"https://github.com/hanzoai\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"GitHub\"}]]}]]}]}]]}]}]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"2015-12-10-cdn-edge-commerce\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L8\",null,[\"$\",\"$L9\",null,{\"children\":[\"$La\",\"$Lb\",[\"$\",\"$Lc\",null,{\"promise\":\"$@d\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"Xgu2UoqrPXmm0qwn91FaFv\",{\"children\":[[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$L10\",null,{\"children\":\"$L11\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"13:\"$Sreact.suspense\"\n14:I[373,[],\"AsyncMetadata\"]\n16:I[9048,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"HashScrollHandler\"]\n17:I[4170,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"CopyHeader\"]\n18:I[9372,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"TableOfContents\"]\n19:I[1413,[\"771\",\"static/chunks/771-2096a43097a1ac56.js\",\"933\",\"static/chunks/933-166e0fcc9496c98f.js\",\"698\",\"static/chunks/698-980099c394b58d6f.js\",\"218\",\"static/chunks/218-3bb2d990159730f8.js\",\"953\",\"static/chunks/app/blog/%5Bslug%5D/page-b595d014fe271b46.js\"],\"MobileTableOfContents\"]\n11:[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$13\",null,{\"fallback\":null,\"children\":[\"$\",\"$L14\",null,{\"promise\":\"$@15\"}]}]}]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"div\",null,{\"className\":\"min-h-screen bg-background relative\",\"children\":[[\"$\",\"$L16\",null,{}],[\"$\",\"div\",null,{\"className\":\"absolute top-0 left-0 z-0 w-full h-[200px] [mask-image:linear-gradient(to_top,transparent_25%,black_95%)]\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"absolute top-0 left-0 size-full\",\"squareSize\":4,\"gridGap\":6,\"color\":\"#6B7280\",\"maxOpacity\":0.2,\"flickerChance\":0.05}]}],[\"$\",\"div\",null,{\"className\":\"space-y-4 border-b border-border relative z-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-7xl mx-auto flex flex-col gap-6 p-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-3 gap-y-5 text-sm text-muted-foreground\",\"children\":[[\"$\",\"$L7\",null,{\"href\":\"/\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"Back to all articles\"}]],\"className\":\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [\u0026_svg]:pointer-events-none [\u0026_svg:not([class*='size-'])]:size-4 shrink-0 [\u0026_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 px-4 py-2 has-[\u003esvg]:px-3 h-6 w-6\",\"ref\":null}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-3 text-muted-foreground\",\"children\":[[\"$\",\"span\",\"cdn\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"cdn\"}],[\"$\",\"span\",\"cloudflare\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"cloudflare\"}],[\"$\",\"span\",\"performance\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"performance\"}],[\"$\",\"span\",\"commerce\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"commerce\"}],[\"$\",\"span\",\"caching\",{\"className\":\"h-6 w-fit px-3 text-sm font-medium bg-muted text-muted-foreground rounded-md border flex items-center justify-center\",\"children\":\"caching\"}]]}],[\"$\",\"time\",null,{\"className\":\"font-medium text-muted-foreground\",\"children\":\"December 9, 2015\"}]]}],[\"$\",\"h1\",null,{\"className\":\"text-4xl md:text-5xl lg:text-6xl font-medium tracking-tighter text-balance\",\"children\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground max-w-4xl md:text-lg md:text-balance\",\"children\":\"Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize.\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex divide-x divide-border relative max-w-7xl mx-auto px-4 md:px-0 z-10\",\"children\":[[\"$\",\"div\",null,{\"className\":\"absolute max-w-7xl mx-auto left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] lg:w-full h-full border-x border-border p-0 pointer-events-none\"}],[\"$\",\"main\",null,{\"className\":\"w-full p-0 overflow-hidden\",\"children\":[null,[\"$\",\"div\",null,{\"className\":\"p-6 lg:p-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"prose dark:prose-invert max-w-none prose-headings:scroll-mt-8 prose-headings:font-semibold prose-a:no-underline prose-headings:tracking-tight prose-headings:text-balance prose-p:tracking-tight prose-p:text-balance prose-lg\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"children\":[[\"$\",\"$L17\",null,{\"level\":1,\"id\":\"cdn-and-edge-delivery-for-commerce-what-you-can-cache-and-what-you-cant\",\"children\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In late 2015 we had moved most of our static assets to Cloudflare. This is the story of what that decision involved, what worked, and the near-disaster of nearly putting checkout behind a CDN cache.\"}],\"\\n\",[\"$\",\"$L17\",null,{\"level\":2,\"id\":\"cloudflare-in-2015\",\"children\":\"Cloudflare in 2015\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Cloudflare's free tier had launched in 2010 and their pro/business tiers were well-established by 2015. Their CDN was legitimately good — 30+ PoPs globally, anycast routing, and a reverse proxy model that required no changes to your origin server setup beyond a DNS change.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The features we used in 2015: CDN for static assets, DDoS protection (which mattered during peak commerce events — flash sales attracted scraper traffic), and their early Workers product was just becoming available in private beta.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"What Cloudflare could not do in 2015: per-request logic at the edge. Their Workers product changed this eventually, but in 2015 the CDN was a pure caching and routing layer. The sophistication was in what you chose to cache and how.\"}],\"\\n\",[\"$\",\"$L17\",null,{\"level\":2,\"id\":\"the-three-categories-of-commerce-assets\",\"children\":\"The Three Categories of Commerce Assets\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Static assets: always cache, long TTL.\"}],\" JavaScript bundles, CSS files, fonts, and the Hanzo SDK — these were versioned by content hash in the filename (\",[\"$\",\"code\",null,{\"children\":\"hanzo-sdk.a3f8c2.min.js\"}],\"). Infinite TTL. The hash changes on every deploy, so cache busting is automatic. A CDN hit serving these from an edge node 20ms from the user is strictly better than a cache miss hitting our origin in a US datacenter.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Image processing was the bigger win. Product images — multiple sizes, WebP and JPEG variants — were stored in S3, served via a CloudFront distribution (later migrated to Cloudflare), and cached at the edge with a 30-day TTL. The origin was never hit for a repeat visitor viewing a product image they had seen before. At scale, product images account for 60-80% of page weight and a significant fraction of origin requests. Eliminating those was meaningful.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Cacheable HTML pages: cache with short TTL and cache-busting strategy.\"}],\" Category pages, product listing pages, even product detail pages for items with no personalized content — these could be cached at the edge for 5-60 minutes with Stale-While-Revalidate semantics. Not appropriate for personalized pages (cart contents, recommendations based on account history) but fine for the top of funnel.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Stale-While-Revalidate approach was important: serve the cached version immediately and refresh the cache in the background. This meant edge cache misses did not translate to user-visible latency spikes.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Checkout: never cache, at the edge or anywhere else.\"}],\" This is where the near-disaster occurred.\"]}],\"\\n\",[\"$\",\"$L17\",null,{\"level\":2,\"id\":\"the-checkout-caching-mistake-we-almost-made\",\"children\":\"The Checkout Caching Mistake We Almost Made\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A client asked why their checkout page load was slow. It was — about 900ms TTFB from the US West Coast to their origin in US East. The obvious answer, based on the success we had caching everything else, was \\\"put it behind the CDN.\\\"\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We almost did it. The request was to add Cloudflare in front of the checkout domain.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The problem: checkout pages are not idempotent. The checkout flow involves:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Session-bound cart state (specific to this user, this device, this session)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"CSRF tokens (must be fresh per form load, cannot be reused)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Price calculations that may change between the time a user adds to cart and the time they hit the pay button (inventory, promotions, tax calculation based on shipping address)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Payment tokenization requests that create server-side intent objects tied to specific amounts\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If you cache a checkout page, you might serve a user someone else's CSRF token, someone else's cart state, or a stale price for an item that changed. In the worst case, you could serve payment intent data from a previous user's session.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We did not implement the CDN for checkout. Instead we:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Moved the checkout origin to a US West Coast datacenter (reducing TTFB by ~300ms for that client's user base)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Improved server-side rendering time (the 900ms was partly origin latency and partly a slow rendering path)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Prefetched the checkout page in the background when the user added their first item to cart, so by the time they clicked checkout, the page was already warm\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The prefetch approach gave the user-perceived performance improvement without the safety risks of caching.\"}],\"\\n\",[\"$\",\"$L17\",null,{\"level\":2,\"id\":\"cache-control-headers\",\"children\":\"Cache-Control Headers\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Getting Cache-Control headers right is an operational discipline. The common mistakes:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Setting \",[\"$\",\"code\",null,{\"children\":\"Cache-Control: public, max-age=86400\"}],\" on dynamically generated pages (caches a specific user's page for 24 hours, serves it to every subsequent visitor)\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Not setting \",[\"$\",\"code\",null,{\"children\":\"Vary: Accept-Encoding\"}],\" on compressed assets (causing uncompressed responses to be served from cache to clients that accept gzip)\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Setting \",[\"$\",\"code\",null,{\"children\":\"Cache-Control: no-cache\"}],\" when you mean \",[\"$\",\"code\",null,{\"children\":\"no-store\"}],\" (no-cache means \\\"check with origin before serving\\\"; no-store means \\\"don't store this at all\\\")\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We standardized on:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Static assets with content-hash in filename: \",[\"$\",\"code\",null,{\"children\":\"Cache-Control: public, max-age=31536000, immutable\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Product images: \",[\"$\",\"code\",null,{\"children\":\"Cache-Control: public, max-age=2592000\"}],\" (30 days)\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"API responses with JSON data: \",[\"$\",\"code\",null,{\"children\":\"Cache-Control: private, max-age=0, no-store\"}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"HTML pages: case-by-case, but defaulting to \",[\"$\",\"code\",null,{\"children\":\"Cache-Control: no-store\"}],\" unless explicitly reviewed\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\"immutable\"}],\" directive (telling the browser not to revalidate even on hard refresh) was new in 2015 and not yet widely supported, but Firefox had it and Chrome was adding it. We used it on the content-hash-named assets.\"]}],\"\\n\",[\"$\",\"hr\",null,{}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":\"Hanzo completed the Cloudflare CDN migration for static assets in Q4 2015. Checkout pages remained on direct origin delivery. The prefetch pattern for checkout warm-up was implemented for high-traffic clients in the same period.\"}]}]],\"className\":\"prose\"}]}]}],[\"$\",\"div\",null,{\"className\":\"mt-10\",\"children\":[\"$\",\"section\",null,{\"className\":\"border-t border-border p-0\",\"children\":[\"$\",\"div\",null,{\"className\":\"p-6 lg:p-10\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl font-medium mb-8\",\"children\":\"Read more\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-col gap-8\",\"children\":[[\"$\",\"$L7\",\"/blog/2024-08-07-candle-ml\",{\"href\":\"/blog/2024-08-07-candle-ml\",\"className\":\"group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-2 flex-1 col-span-1 lg:col-span-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2\",\"children\":\"Candle: Rust-Native Machine Learning\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4\",\"children\":\"Introducing our investment in Candle, the Rust ML framework powering Hanzo's next-generation inference.\"}],[\"$\",\"time\",null,{\"className\":\"block text-xs font-medium text-muted-foreground\",\"children\":\"August 6, 2024\"}]]}]]}],[\"$\",\"$L7\",\"/blog/2022-11-16-identity-nfts\",{\"href\":\"/blog/2022-11-16-identity-nfts\",\"className\":\"group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-2 flex-1 col-span-1 lg:col-span-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2\",\"children\":\"Identity NFTs: Portable Commerce Identity\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4\",\"children\":\"Introducing Identity NFTs: blockchain-based portable identity for commerce.\"}],[\"$\",\"time\",null,{\"className\":\"block text-xs font-medium text-muted-foreground\",\"children\":\"November 15, 2022\"}]]}]]}],[\"$\",\"$L7\",\"/blog/2021-10-27-multi-modal-ai\",{\"href\":\"/blog/2021-10-27-multi-modal-ai\",\"className\":\"group grid grid-cols-1 lg:grid-cols-12 items-center gap-4 cursor-pointer\",\"children\":[\"$undefined\",[\"$\",\"div\",null,{\"className\":\"space-y-2 flex-1 col-span-1 lg:col-span-8\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"text-lg group-hover:underline underline-offset-4 font-semibold text-card-foreground group-hover:text-primary transition-colors line-clamp-2\",\"children\":\"Multi-Modal AI for Commerce\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm line-clamp-3 group-hover:underline underline-offset-4\",\"children\":\"How we are combining vision, language, and structured data for next-generation commerce AI.\"}],[\"$\",\"time\",null,{\"className\":\"block text-xs font-medium text-muted-foreground\",\"children\":\"October 26, 2021\"}]]}]]}]]}]]}]}]}]]}],[\"$\",\"aside\",null,{\"className\":\"hidden lg:block w-[350px] flex-shrink-0 p-6 lg:p-10 bg-muted/60 dark:bg-muted/20\",\"children\":[\"$\",\"div\",null,{\"className\":\"sticky top-20 space-y-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-start gap-2\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"h3\",null,{\"className\":\"text-sm tracking-tight text-balance font-semibold\",\"children\":\"Zach Kelling\"}]}]}],[\"$\",\"div\",null,{\"className\":\"border border-border rounded-lg p-6 bg-card\",\"children\":[\"$\",\"$L18\",null,{}]}]]}]}]]}],[\"$\",\"$L19\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"2\",{\"name\":\"theme-color\",\"content\":\"black\"}]]\na:null\n"])</script><script>self.__next_f.push([1,"d:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't - Hanzo Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize.\"}],[\"$\",\"link\",\"2\",{\"rel\":\"author\",\"href\":\"https://blog.hanzo.ai\"}],[\"$\",\"meta\",\"3\",{\"name\":\"author\",\"content\":\"Zach Kelling\"}],[\"$\",\"meta\",\"4\",{\"name\":\"keywords\",\"content\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't,cdn,cloudflare,performance,commerce,caching,Hanzo AI,Blog,AI Research,Infrastructure\"}],[\"$\",\"meta\",\"5\",{\"name\":\"creator\",\"content\":\"Zach Kelling\"}],[\"$\",\"meta\",\"6\",{\"name\":\"publisher\",\"content\":\"Hanzo AI\"}],[\"$\",\"meta\",\"7\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"8\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"9\",{\"rel\":\"canonical\",\"href\":\"https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:title\",\"content\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:description\",\"content\":\"Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize.\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:url\",\"content\":\"https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:site_name\",\"content\":\"Hanzo Blog\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:image\",\"content\":\"https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce/opengraph-image\"}],[\"$\",\"meta\",\"15\",{\"property\":\"og:image:width\",\"content\":\"1200\"}],[\"$\",\"meta\",\"16\",{\"property\":\"og:image:height\",\"content\":\"630\"}],[\"$\",\"meta\",\"17\",{\"property\":\"og:image:alt\",\"content\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't\"}],[\"$\",\"meta\",\"18\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"19\",{\"property\":\"article:published_time\",\"content\":\"2015-12-10\"}],[\"$\",\"meta\",\"20\",{\"property\":\"article:author\",\"content\":\"Zach Kelling\"}],[\"$\",\"meta\",\"21\",{\"property\":\"article:tag\",\"content\":\"cdn\"}],[\"$\",\"meta\",\"22\",{\"property\":\"article:tag\",\"content\":\"cloudflare\"}],[\"$\",\"meta\",\"23\",{\"property\":\"article:tag\",\"content\":\"performance\"}],[\"$\",\"meta\",\"24\",{\"property\":\"article:tag\",\"content\":\"commerce\"}],[\"$\",\"meta\",\"25\",{\"property\":\"article:tag\",\"content\":\"caching\"}],[\"$\",\"meta\",\"26\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"27\",{\"name\":\"twitter:site\",\"content\":\"@hanzoai\"}],[\"$\",\"meta\",\"28\",{\"name\":\"twitter:creator\",\"content\":\"@hanzoai\"}],[\"$\",\"meta\",\"29\",{\"name\":\"twitter:title\",\"content\":\"CDN and Edge Delivery for Commerce: What You Can Cache and What You Can't\"}],[\"$\",\"meta\",\"30\",{\"name\":\"twitter:description\",\"content\":\"Product images and JS bundles belong at the edge. Checkout belongs nowhere near it. The distinction matters more than most commerce engineers realize.\"}],[\"$\",\"meta\",\"31\",{\"name\":\"twitter:image\",\"content\":\"https://blog.hanzo.ai/blog/2015-12-10-cdn-edge-commerce/opengraph-image\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"15:{\"metadata\":\"$d:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>